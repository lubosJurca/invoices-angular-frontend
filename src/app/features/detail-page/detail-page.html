<div class="max-w-6xl mx-auto p-6">
  @if(loading) {
  <div class="flex justify-center items-center min-h-96">
    <p-progressSpinner />
  </div>
  } @else { @if(invoice$ | async; as invoice) {
  <!-- Header with back button -->
  <div class="flex items-center justify-between mb-6">
    <button
      (click)="goBack()"
      class="flex items-center gap-2 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 font-medium"
      type="button"
    >
      <i class="pi pi-arrow-left"></i>
      Back to Invoices
    </button>
    <p-tag [value]="invoice.status" [severity]="getSeverity(invoice.status)" />
  </div>

  <!-- Invoice Header Card -->
  <p-card class="mb-6">
    <ng-template #header>
      <div class="p-6 border-b">
        <div class="flex justify-between items-start">
          <div>
            <h1
              class="text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2"
            >
              Invoice #{{ invoice._id?.slice(-8) }}
            </h1>
            <p class="text-gray-600 dark:text-gray-300">
              {{ invoice.description }}
            </p>
          </div>
          <div class="text-right">
            <div class="text-sm text-gray-500 dark:text-gray-400 mb-1">
              Total Amount
            </div>
            <div class="text-3xl font-bold text-green-600 dark:text-green-400">
              {{ invoice.total | currency }}
            </div>
          </div>
        </div>
      </div>
    </ng-template>

    <!-- Invoice Details -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 p-6">
      <div>
        <div class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">
          Created Date
        </div>
        <div class="text-gray-900 dark:text-gray-100">
          {{ invoice.createdAt | date:'mediumDate' }}
        </div>
      </div>
      <div>
        <div class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">
          Due Date
        </div>
        <div class="text-gray-900 dark:text-gray-100">
          {{ invoice.dueDate | date:'mediumDate' }}
        </div>
      </div>
      <div>
        <div class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">
          Payment Terms
        </div>
        <div class="text-gray-900 dark:text-gray-100">
          {{ invoice.paymentTerms }} days
        </div>
      </div>
      <div>
        <div class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">
          Status
        </div>
        <p-tag
          [value]="invoice.status"
          [severity]="getSeverity(invoice.status)"
        />
      </div>
    </div>
  </p-card>

  <!-- Client & Sender Information -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
    <!-- Sender Information -->
    <p-card>
      <ng-template #header>
        <div class="p-6 border-b dark:border-gray-700">
          <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100">
            From
          </h2>
        </div>
      </ng-template>
      <div class="p-6">
        <div class="space-y-2">
          <div class="text-gray-600 dark:text-gray-300">
            {{ invoice.senderAddress.street }}
          </div>
          <div class="text-gray-600 dark:text-gray-300">
            {{ invoice.senderAddress.city }}
          </div>
          <div class="text-gray-600 dark:text-gray-300">
            {{ invoice.senderAddress.country }}
          </div>
          @if(invoice.senderAddress.postCode) {
          <div class="text-gray-600 dark:text-gray-300">
            {{ invoice.senderAddress.postCode }}
          </div>
          }
        </div>
      </div>
    </p-card>

    <!-- Client Information -->
    <p-card>
      <ng-template #header>
        <div class="p-6 border-b dark:border-gray-700">
          <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100">
            Bill To
          </h2>
        </div>
      </ng-template>
      <div class="p-6">
        <div class="mb-4">
          <div class="font-semibold text-gray-900 dark:text-gray-100">
            {{ invoice.clientName }}
          </div>
          <div class="text-blue-600 dark:text-blue-400">
            {{ invoice.clientEmail }}
          </div>
        </div>
        <div class="space-y-2">
          <div class="text-gray-600 dark:text-gray-300">
            {{ invoice.clientAddress.street }}
          </div>
          <div class="text-gray-600 dark:text-gray-300">
            {{ invoice.clientAddress.city }}
          </div>
          <div class="text-gray-600 dark:text-gray-300">
            {{ invoice.clientAddress.country }}
          </div>
          @if(invoice.clientAddress.postCode) {
          <div class="text-gray-600 dark:text-gray-300">
            {{ invoice.clientAddress.postCode }}
          </div>
          }
        </div>
      </div>
    </p-card>
  </div>

  <!-- Invoice Items -->
  <p-card class="mb-6">
    <ng-template #header>
      <div class="p-6 border-b">
        <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100">
          Items
        </h2>
      </div>
    </ng-template>

    <div class="p-6">
      <p-table [value]="invoice.items" [tableStyle]="{ 'min-width': '50rem' }">
        <ng-template #header>
          <tr>
            <th class="text-left">Item Name</th>
            <th class="text-center">Quantity</th>
            <th class="text-right">Price</th>
            <th class="text-right">Total</th>
          </tr>
        </ng-template>
        <ng-template #body let-item>
          <tr>
            <td class="font-medium">{{ item.name }}</td>
            <td class="text-center">{{ item.quantity }}</td>
            <td class="text-right">{{ item.price | currency }}</td>
            <td class="text-right font-semibold">
              {{ calculateItemTotal(item.quantity, item.price) | currency }}
            </td>
          </tr>
        </ng-template>
        <ng-template #summary>
          <tr>
            <td
              colspan="3"
              class="text-right font-semibold border-t dark:border-gray-700 pt-4"
            >
              Grand Total:
            </td>
            <td
              class="text-right font-bold text-lg border-t dark:border-gray-700 pt-4"
            >
              {{ invoice.total | currency }}
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </p-card>

  <!-- Action Buttons -->
  <div class="flex justify-end gap-4">
    <p-button
      label="Edit Invoice"
      icon="pi pi-pencil"
      [outlined]="true"
      class="p-button-primary"
    />
    <p-button
      label="Download PDF"
      icon="pi pi-download"
      class="p-button-secondary"
    />
    <p-button
      label="Mark as Paid"
      icon="pi pi-check"
      class="p-button-success"
      [disabled]="invoice.status === 'paid'"
    />
  </div>

  <!-- Metadata -->
  @if(invoice.updatedAt) {
  <div
    class="mt-8 pt-6 border-t dark:border-gray-700 text-sm text-gray-500 dark:text-gray-400 text-center"
  >
    Last updated: {{ invoice.updatedAt | date:'medium' }}
  </div>
  } } @else {
  <!-- Invoice not found -->
  <div class="text-center py-16">
    <div class="max-w-md mx-auto">
      <div
        class="w-24 h-24 bg-gray-100 dark:bg-gray-800 rounded-full mx-auto flex items-center justify-center mb-6"
      >
        <i class="pi pi-file-o text-4xl text-gray-400 dark:text-gray-500"></i>
      </div>
      <h2 class="text-2xl font-semibold text-gray-700 dark:text-gray-200 mb-2">
        Invoice Not Found
      </h2>
      <p class="text-gray-500 dark:text-gray-400 mb-6">
        The invoice you're looking for doesn't exist or has been removed.
      </p>
      <p-button
        label="Back to Invoices"
        icon="pi pi-arrow-left"
        (onClick)="goBack()"
        [outlined]="true"
      />
    </div>
  </div>
  } }
</div>
